<div class="container-fluid">
    <div class="col-md-12">
        <ol class="breadcrumb">
            <li>
                <a href="#/servicios" ng-if="!isRoot()">Todos</a>
                <span ng-if="isRoot()">Todos</span> </li>
            <li ng-repeat="item in currentParents" ng-class="{'active':$last}">
                <a href="#/servicios/{{ item.customId }}">{{item.nombre}}</a>
            </li>
            <li ng-if="!isRoot()">
                <span>{{ currentSelection.nombre }}</span>
            </li>
        </ol>
    </div>


    <div class="col-md-12">
        <div alert
             ng-repeat="alert in alerts"
             data-type="{{alert.type}}"
             data-close="closeAlert($index, alerts)">
            {{alert.msg}}</div>
    </div>


    <div ng-class="currentSelection.nodeType == 'LEAF'? 'col-md-12': 'col-md-8'" ng-show="!isRoot()">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Datos de <span class="gray-higher">{{currentSelection.nombre | capitalize}}</span>
                    <label class="pull-right" ng-show="rolesName.indexOf(currentSelection.customId) > -1">
                        <input type="checkbox"
                               ng-model="currentSelection.visible"
                               ng-change="updateVisibility(currentSelection)">
                        Visible
                    </label>
                    <!--<small class="pull-right">{{currentSelection.domainClass}} ({{currentSelection.nodeType}})</small>-->
                </h4></div>
            <div class="panel-body">
                <!--<label>-->
                    <!--<input type="checkbox"-->
                           <!--ng-model="currentSelection.visible"-->
                           <!--ng-change="updateVisibility(currentSelection)">-->
                    <!--Visible-->
                <!--</label>-->
                <div ng-if="!isRoot(currentSelection)">
                    <form novalidate
                          name="generalesForm"
                          ng-submit="updateGenerals(currentSelection)">
                    <div class="form-group"
                         ng-class="{'has-error': generalesForm.nombre.$invalid && generalesForm.nombre.$dirty}">
                        <label for="descName"
                               class="control-label">
                            Nombre
                            <span ng-show="generalesForm.nombre.$dirty && generalesForm.nombre.$error.required"
                                  class="text-danger"> *</span>
                        </label>
                        <input type="text"
                               class="form-control"
                               id="descName"
                               name="nombre"
                               required
                               ng-model="currentSelection.nombre">
                    </div>
                    <div class="form-group"
                         ng-class="{'has-error': generalesForm.descripcion.$invalid && generalesForm.descripcion.$dirty}">
                        <label for="descInpt" class="control-label">
                            Descripción
                            <span ng-show="generalesForm.descripcion.$dirty && generalesForm.descripcion.$error.required"
                                  class="text-danger"> *</span>
                        </label>
                        <textarea class="form-control"
                                  id="descInpt"
                                  required
                                  name="descripcion"
                                  rows="5" style="resize: none;"
                                  data-ng-model="currentSelection.descripcion"></textarea>
                    </div>
                        <div class="col-md-12">
                            <button type="submit"
                                    data-ng-disabled="generalesForm.$invalid || !generalesForm.$dirty"
                                    class="btn btn-primary pull-right">
                                <span class="glyphicon glyphicon-edit"></span>
                                Actualizar</button>
                        </div>
                    </form>
                </div>
                <div ng-if="currentSelection.nodeType == 'BRANCH'" class="col-md-12">
                    <div class="page-header">
                        <h3>Propiedades
                            <small>
                                <a href=""
                                   ng-click="showPropForm()"
                                   ng-hide="addingProperty"
                                   class="btn btn-link pull-right">
                                    <span class="glyphicon glyphicon-plus-sign"></span> Nueva
                                </a>
                            </small>
                        </h3>
                    </div>
                    <div class="col-md-12 form-group" ng-repeat="prop in currentSelection.propiedades">
                        <strong>{{prop.nombre | capitalize}}</strong> es de tipo <em>{{prop.tipo}}</em>
                        <a href=""
                           ng-click="dropProperty(prop, currentSelection)"
                           class="btn btn-link pull-right">
                            <i class="glyphicon glyphicon-trash"></i> </a>
                        <ul ng-show="prop.options">
                            <li ng-repeat="opt in prop.options">
                                {{ opt }}
                            </li>
                        </ul>
                    </div>
                </div>

                <div ng-show="addingProperty">
                    <form novalidate
                          no-submit-form
                          data-prevent-if="newPropertyForm.forSubmit"
                          data-callback="addProp(currentSelection)"
                          name="newPropertyForm">
                        <div class="col-md-12">
                            <div alert
                                 ng-repeat="alert in propertyAlerts"
                                 data-type="{{alert.type}}"
                                 data-close="closeAlert($index, propertyAlerts)">
                                {{alert.msg}}</div>
                        </div>
                    <div class="form-group"
                         ng-class="{'has-error': newPropertyForm.nombre.$invalid && newPropertyForm.nombre.$dirty}">
                        <label for="propName"
                               class="control-label">
                            Nombre
                            <span ng-show="newPropertyForm.nombre.$dirty && newPropertyForm.nombre.$error.required"
                                  class="text-danger"> *</span>
                        </label>
                        <input type="text"
                               class="form-control"
                               id="propName"
                               name="nombre"
                               required
                               ng-model="newProperty.nombre"/>
                        <span class="help-block text-danger"
                              ng-show="newPropertyForm.nombre.serverErrors">
                            <span ng-repeat="errorMessage in newPropertyForm.nombre.serverErrors">
                                {{errorMessage}}</span>
                        </span>
                    </div>
                    <div class="form-group"
                         ng-class="{'has-error': newPropertyForm.descripcion.$invalid && newPropertyForm.descripcion.$dirty}">
                        <label for="propDesc"
                               class="control-label">
                            Descripción
                            <span ng-show="newPropertyForm.descripcion.$dirty && newPropertyForm.descripcion.$error.required"
                                  class="text-danger"> *</span>
                        </label>
                        <textarea name="descripcion"
                                  id="propDesc"
                                  required
                                  class="form-control"
                                  data-ng-model="newProperty.descripcion"
                                  rows="5" style="resize: none;"></textarea>
                        <span class="help-block text-danger"
                              ng-show="newPropertyForm.descripcion.serverErrors">
                            <span ng-repeat="errorMessage in newPropertyForm.descripcion.serverErrors">
                                {{errorMessage}}</span>
                        </span>
                    </div>
                    <div class="form-group"
                         ng-class="{'has-error': newPropertyForm.tipo.$invalid && newPropertyForm.tipo.$dirty}">
                        <label for="propType"
                               class="control-label">
                            Tipo
                            <span ng-show="newPropertyForm.tipo.$dirty && newPropertyForm.tipo.$error.required"
                                  class="text-danger"> *</span>
                        </label>
                        <select data-ng-model="newProperty.tipo"
                                class="form-control"
                                required
                                name="tipo"
                                ng-options="type for type in propertyTypes"
                                id="propType">
                            <option value=""
                                    ng-class="{'text-danger': newPropertyForm.tipo.$dirty && newPropertyForm.tipo.$error.required}">
                                -- Elige -- </option>
                        </select>
                        <span class="help-block text-danger"
                              ng-show="newPropertyForm.tipo.serverErrors">
                            <span ng-repeat="errorMessage in newPropertyForm.tipo.serverErrors">
                                {{errorMessage}}</span>
                        </span>
                    </div>
                        <div class="form-group" ng-show="isIn(newProperty.tipo, ['CHECK', 'RADIO'])">
                            <div class="list-group">
                                <span class="list-group-item">
                                <span class="list-group-item-heading">
                                    <strong>Opciones</strong>
                                </span>
                                    </span>
                                <span class="list-group-item" ng-repeat="opt in newProperty.options">
                                    {{ opt }}
                                </span>
                                <input type="text"
                                       placeholder="Agregar opción"
                                       class="form-control"
                                       prevent-submit
                                       data-notify-to="newPropertyForm.forSubmit"
                                       ng-keyup="$event.keyCode == 13 && addOption(newProperty)"
                                       ng-model="newProperty.tempOpt">
                                <p class="help-block" ng-show="newPropertyForm.forSubmit">
                                    <span class="text-info"> Presiona ENTER para agregar la nueva opción</span>
                                </p>
                            </div>
                        </div>
                    <div class="btn-group new-prop-btns pull-right">
                        <button class="btn btn-default btn-sm btn-add-prop"
                                data-ng-disabled="newPropertyForm.$invalid"
                                type="submit">
                            Agregar</button>
                        <button type="button" class="btn btn-default btn-sm btn-add-prop"
                                ng-click="cancelProp()">
                            Cancelar</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>





    <!--<div class="row">-->
    <div class="col-md-4" ng-show="currentSelection.nodeType != 'LEAF'">
        <div class="container list-group no-margin" style="margin-bottom: 0;">
            <div class="list-group-item">
                <div class="list-group-item-heading">
                    <h4 class="text-center">
                        {{currentSelection.length !== categories.length? 'Hijos de '+currentSelection.nombre: 'Todas las categorías'}}
                    </h4>
                </div>
            </div>
            <div ng-repeat="child in getChildren(currentSelection)"
                 class="col-sm-12 list-group-item"
                 ng-class="$last? 'spaced-bottom': ''">
                <a href="#/servicios/{{ child.customId }}"
                   class="col-sm-10">
                    {{child.nombre}}
                    <span class="pull-right">
                        <a href=""
                           ng-click="removeChild(child)"
                           style="background-image: none !important;"
                           class="btn btn-default col-sm-2 pull-right btn-xs">
                            <i class="glyphicon glyphicon-trash"></i> </a>
                    </span>
                </a>
            </div>
        </div>

        <div class="container list-group no-margin">
            <div class="list-group-item-heading">
                <h4 class="text-center"
                    style="padding-bottom:10px; margin-top:5px; margin-bottom:0; padding-top:10px; -webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px; background-color: #ddd; color: #777;">
                    Nuevo elemento</h4>
                <div alert
                     ng-repeat="alert in itemAlerts"
                     data-type="{{alert.type}}"
                     data-close="closeAlert($index, itemAlerts)"
                     class="small"
                     style="margin-bottom: 0">
                    {{alert.msg}}</div>
                <!--<div growl></div>-->
                <form class="form" novalidate name="newItemForm">
                    <div class=""
                         style="border: 1px solid #dddddd; -webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px; padding: 8px;"
                         ng-class="{'has-error': newItemForm.domainType.$invalid && newItemForm.domainType.$dirty}"
                         ng-show="!isRoot()">
                        <label
                                ng-show="currentSelection.customId !== 'ingenieria_en_sitio' && currentSelection.customId !== 'tecnologia'">
                            <input type="radio" name="domainType" value="concepto"
                                   ng-checked="checkForDefault(currentSelection, newItemform.domainType)"
                                   ng-required="!isRoot()"
                                   ng-model="newItem.domainType">Concepto
                            <span class="btn btn-link glyphicon glyphicon-question-sign input-group-addon"
                                  ng-click="$event.stopPropagation(); $event.preventDefault();"
                                  style="border:none; background-color: inherit; color: inherit; display: inline-block;"
                                  data-popover-trigger="mouseenter"
                                  popover="Concepto es un nodo simple, es renderizado como un checkbox">
                        </span>
                        </label>

                        <label
                                ng-show="currentSelection.domainClass.toLowerCase() !== 'conceptoespecial' && currentSelection.customId !== 'tipo_de_cliente'">
                            <input type="radio" name="domainType"
                                   value="componente"
                                   ng-checked="checkForDefault(currentSelection, newItemform.domainType)"
                                   ng-required="!isRoot()"
                                   ng-model="newItem.domainType">Componente
                            <span class="btn btn-link glyphicon glyphicon-question-sign input-group-addon"
                                  ng-click="$event.stopPropagation(); $event.preventDefault();"
                                  style="border:none; background-color: inherit; color: inherit; display: inline-block;"
                                  data-popover-trigger="mouseenter"
                                  data-popover-placement="left"
                                  popover="Componente es un nodo contenedor de propiedades y conceptos, ej. componente Firewall contiene propiedades cantidad y marca, además contiene los conceptos NAT, HA, ...">
                        </span>
                        </label>
                    </div>
                    <div class=""
                         ng-class="{'has-error': newItemForm.nombre.$invalid && newItemForm.nombre.$dirty}">
                        <input placeholder="Nombre"
                               name="nombre"
                               required
                               class="form-control"
                               ng-model="newItem.nombre">
                    </div>
                    <div class=""
                         ng-class="{'has-error': newItemForm.descripcion.$invalid && newItemForm.descripcion.$dirty}">
                        <input type="text"
                               placeholder="Descripción"
                               name="descripcion"
                               required
                               class="form-control"
                               ng-model="newItem.descripcion">
                    </div>
                    <button type="submit"
                            class="btn btn-default form-control"
                            ng-click="addItem(newItem)"
                            data-ng-disabled="newItemForm.$invalid">
                        <span class="glyphicon glyphicon-plus"></span> Agregar
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!--</div>-->
    
    
    <div class="col-md-8" ng-if="isRoot()">
        <h3>Overview</h3>
        <p>Los servicios elegibles forman una estructura de árbol. Existen 4 tipos de nodos:</p>
        <ol>
            <li><strong>Categoria</strong> Es el nodo raíz de un 'grupo' de elementos con alguna relación estrecha. Puede tener hijos <em>Componente</em> y <em>Concepto</em>. Ej. tipo de cliente es una <em>Categoría</em> que contiene los
                <em>Conceptos</em> privado, gobierno y financiero.</li>
            <li><strong>Componente</strong> Estos nodos son intermedios y sirven como contenedores de <em>Conceptos</em> y <em>Propiedades</em>, no pueden ser nodos raíz ni hoja.<br/>
                Las <em>Propiedades</em> que definidas dentro de él, afectan a todos los <em>Conceptos</em>
                contenidos en dicho <em>Componente</em>.</li>
            <li><strong>Propiedad</strong> Solo pueden ser hijos de <em>Componente</em>. Cada uno de estos nodos
                representa alguna característica muy específica y su valor puede ser de varios tipos(numérico, un
                único texto de una lista predefinida, múltiples valores de una lista predefinida, un texto
                cualquiera). Ej. la cantidad de IPS; IPS es el <em>Componente</em> y la cantidad una <em>Propiedad</em>.</li>
            <li><strong>Concepto</strong> Son nodos hoja que representan un valor booleano, es renderizado como un
                checkbox. Ej. Firewall con HA; Firewall es el <em>Componente</em> y HA es un <em>concepto</em>.</li>
        </ol>
    </div>

</div>